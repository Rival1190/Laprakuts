<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Login & Registrasi</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container login-container">
        <div id="login-view">
            <h2>Login</h2>
            <form id="loginForm">
                <div class="form-group"><label for="loginUsername">Username</label><input type="text" id="loginUsername" required></div>
                <div class="form-group"><label for="loginPassword">Password</label><input type="password" id="loginPassword" required></div>
                <button type="submit">Login</button>
            </form>
            <p class="message" id="loginMessage"></p>
            <p class="toggle-form" onclick="toggleView()">Belum punya akun? Registrasi</p>
        </div>
        <div id="register-view" style="display:none;">
            <h2>Registrasi</h2>
            <form id="registerForm">
                 <div class="form-group"><label for="registerUsername">Username</label><input type="text" id="registerUsername" required></div>
                <div class="form-group"><label for="registerPassword">Password</label><input type="password" id="registerPassword" required></div>
                <button type="submit">Registrasi</button>
            </form>
            <p class="message" id="registerMessage"></p>
            <p class="toggle-form" onclick="toggleView()">Sudah punya akun? Login</p>
        </div>
    </div>
<script>
    const loginView = document.getElementById('login-view'), registerView = document.getElementById('register-view');
    const loginForm = document.getElementById('loginForm'), registerForm = document.getElementById('registerForm');
    const loginMessage = document.getElementById('loginMessage'), registerMessage = document.getElementById('registerMessage');

    function toggleView() {
        loginView.style.display = loginView.style.display === 'none' ? 'block' : 'none';
        registerView.style.display = registerView.style.display === 'none' ? 'block' : 'none';
    }

    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const res = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: loginUsername.value, password: loginPassword.value })
        });
        const data = await res.json();
        if (res.ok) window.location.href = data.user.isAdmin ? '/admin-dashboard.html' : '/chat.html';
        else { loginMessage.textContent = data.message; loginMessage.className = 'message error'; }
    });

    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const res = await fetch('/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: registerUsername.value, password: registerPassword.value })
        });
        const data = await res.json();
        registerMessage.textContent = data.message;
        registerMessage.className = res.ok ? 'message success' : 'message error';
        if (res.ok) { registerForm.reset(); setTimeout(toggleView, 1500); }
    });
</script>
</body>
</html>